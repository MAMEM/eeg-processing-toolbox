<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of CSPWrapper</title>
  <meta name="keywords" content="CSPWrapper">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">+eegtoolkit</a> &gt; <a href="#">+classification</a> &gt; <a href="index.html">@CSPWrapper</a> &gt; CSPWrapper.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for +eegtoolkit/+classification/@CSPWrapper&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>CSPWrapper
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="CSPWrapper.html" class="code" title="">CSPWrapper</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="CSPWrapper.html" class="code" title="">CSPWrapper</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function CSP = CSPWrapper(instanceSet)</a></li><li><a href="#_sub2" class="code">function CSP = build(CSP)</a></li><li><a href="#_sub3" class="code">function [output, probabilities, ranking] = classifyInstance(CSP,instance)</a></li><li><a href="#_sub4" class="code">function CSP = reset(CSP)</a></li><li><a href="#_sub5" class="code">function configInfo = getConfigInfo(CSP)</a></li><li><a href="#_sub6" class="code">function time = getTime(CSP)</a></li><li><a href="#_sub7" class="code">function [] = learnCSPMatrix(CSP, sMatrix, labels)</a></li><li><a href="#_sub8" class="code">function instances = extract(CSP,sMatrix)</a></li></ul>
<h2><a name="_download"></a>DOWNLOAD <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<p><a href="CSPWrapper.m">CSPWrapper.m</a></p>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="CSPWrapper.html" class="code" title="">CSPWrapper</a> &lt; eegtoolkit.classification.ClassifierBase;
0002     properties (Constant)
0003         
0004     <span class="keyword">end</span>
0005     properties
0006         baseClassifier;
0007         channel;
0008         cspFilter;
0009     <span class="keyword">end</span>
0010     
0011     methods (Access = public)
0012         <a name="_sub0" href="#_subfunctions" class="code">function CSP = CSPWrapper(instanceSet)</a>
0013 <span class="comment">%             if(isa(instanceSet,'eegtoolkit.util.RawSignalSet')</span>
0014 <span class="comment">%                 CSP.instanceSet = instanceSet;</span>
0015 <span class="comment">%             else</span>
0016 <span class="comment">%                 error('RawSignal extractor should be used with CSPWrapper');</span>
0017 <span class="comment">%             end</span>
0018         <span class="keyword">end</span>
0019         
0020         
0021         <a name="_sub1" href="#_subfunctions" class="code">function CSP = build(CSP)</a>
0022             <span class="comment">% Builds the classification models</span>
0023             CSP.learnCSPMatrix(CSP.instanceSet.sMatrix,CSP.instanceSet.labels);
0024             instanceLocal = CSP.extract(CSP.instanceSet.sMatrix);
0025             CSP.baseClassifier.instanceSet = eegtoolkit.util.InstanceSet(instanceLocal,CSP.instanceSet.labels);
0026             CSP.baseClassifier.build;
0027             CSP.reset;
0028         <span class="keyword">end</span>
0029         
0030         <a name="_sub2" href="#_subfunctions" class="code">function [output, probabilities, ranking] = classifyInstance(CSP,instance)</a>
0031 <span class="comment">%             instance = CSP.extract</span>
0032             <span class="comment">%input = instance matrix rows = instances, cols = attributes</span>
0033             <span class="comment">%output = predicted class</span>
0034             <span class="comment">%probabilities = probability for predicted class</span>
0035             <span class="comment">%ranking = propabilities for all classes (e.g. to use with mAP)</span>
0036             
0037             <span class="comment">%TODO:should print an error if 'build' has not been called</span>
0038             testInstances = CSP.extract(instance);
0039             [output, probabilities, ranking] = CSP.baseClassifier.classifyInstance(testInstances);
0040 <span class="comment">%             numModels = length(LSVM.models);</span>
0041 <span class="comment">%             [numinstance, ~] = size(testInstances);</span>
0042 <span class="comment">%             scores = zeros(numModels,numinstance);</span>
0043 <span class="comment">%             for i=1:numModels</span>
0044 <span class="comment">%                 %predict using the stored models</span>
0045 <span class="comment">%                 [~, ~, t] = svmpredict(eye(numinstance,1),testInstances, LSVM.models{i},'-b 1 -q');</span>
0046 <span class="comment">%                 %store probability for each class</span>
0047 <span class="comment">%                 scores(i,:) = t(:,1);</span>
0048 <span class="comment">%             end</span>
0049 <span class="comment">%             output = zeros(numinstance,1);</span>
0050 <span class="comment">%             probabilities = zeros(numinstance,1);</span>
0051 <span class="comment">%             ranking = scores;</span>
0052 <span class="comment">%             for i=1:numinstance</span>
0053 <span class="comment">%                 %select the class with the highest probability</span>
0054 <span class="comment">%                 [prob, idx] = max(scores(:,i));</span>
0055 <span class="comment">%                 uniqueLabels = unique(LSVM.instanceSet.getLabels);</span>
0056 <span class="comment">%                 %output the label with highest probability</span>
0057 <span class="comment">%                 output(i,1) = uniqueLabels(idx);</span>
0058 <span class="comment">%                 %return the probability for the output label</span>
0059 <span class="comment">%                 probabilities(i,1) = prob;</span>
0060 <span class="comment">%             end</span>
0061         <span class="keyword">end</span>
0062         
0063         <a name="_sub3" href="#_subfunctions" class="code">function CSP = reset(CSP)</a>
0064             <span class="comment">% 'Resets' the classifier.</span>
0065 <span class="comment">%             CSP.models = {};</span>
0066         <span class="keyword">end</span>
0067         
0068         <a name="_sub4" href="#_subfunctions" class="code">function configInfo = getConfigInfo(CSP)</a>
0069             configInfo = <span class="string">'\n'</span>;
0070         <span class="keyword">end</span>
0071         
0072                         
0073         <a name="_sub5" href="#_subfunctions" class="code">function time = getTime(CSP)</a>
0074             time = 0;
0075         <span class="keyword">end</span>
0076     <span class="keyword">end</span>
0077     methods (Access = private)
0078         <a name="_sub6" href="#_subfunctions" class="code">function [] = learnCSPMatrix(CSP, sMatrix, labels)</a>
0079             [numTrials,numChannels,~] = size(sMatrix);
0080 <span class="comment">%             labels = CSP.instanceSet.getLabels;</span>
0081 <span class="comment">%             sMatrix = permute(sMatrix,[2,3,1]);</span>
0082 <span class="comment">%             sMatrix = permute(sMatrix,[2 1 3]);</span>
0083             sMatrix = permute(sMatrix,[3,2,1]);
0084             <span class="keyword">for</span> i=1:numChannels
0085                 <span class="keyword">for</span> j=1:numTrials
0086                     sMatrix(:,i,j) = (sMatrix(:,i,j) - mean(sMatrix(:,i,j)));
0087                 <span class="keyword">end</span>
0088             <span class="keyword">end</span>
0089             trialCov = zeros(numChannels,numChannels,numTrials);
0090             <span class="keyword">for</span> t=1:length(labels)
0091                 E = sMatrix(:,:,t)';
0092                 EE = E * E';
0093                 trialCov(:,:,t) = EE ./trace(EE);
0094             <span class="keyword">end</span>
0095             <span class="comment">%TODO: works only for 2 labels, [1,2]</span>
0096             <span class="keyword">for</span> c=1:2
0097                 covMat{c} = mean(trialCov(:,:,labels == c),3);
0098             <span class="keyword">end</span>
0099             [U, D] = eig(covMat{1},covMat{2},<span class="string">'qz'</span>);
0100             eigenvalues = diag(D);
0101             [~,ind] = sort(eigenvalues,<span class="string">'descend'</span>);
0102             U = U(:,ind);
0103             CSP.cspFilter = U';
0104 <span class="comment">%             for i=1:size(sMatrix,3);</span>
0105 <span class="comment">%                 sMatrix(:,:,i) = (cspFilter*sMatrix(:,:,i)')';</span>
0106 <span class="comment">%             end</span>
0107 <span class="comment">%             instances = zeros(numTrials,numChannels);</span>
0108 <span class="comment">%             for i=1:numTrials</span>
0109 <span class="comment">%                 projectedTrial = sMatrix(:,:,i);</span>
0110 <span class="comment">%                 variances = var(projectedTrial,0,1);</span>
0111 <span class="comment">%                 instances(i,:) = log(variances)';</span>
0112 <span class="comment">%             end</span>
0113 <span class="comment">%             instanceSet = eegtoolkit.util.InstanceSet(instances,labels);</span>
0114         <span class="keyword">end</span>
0115         
0116         <a name="_sub7" href="#_subfunctions" class="code">function instances = extract(CSP,sMatrix)</a>
0117             
0118             [numTrials,numChannels,~] = size(sMatrix);
0119             sMatrix = permute(sMatrix,[3,2,1]);
0120             <span class="keyword">for</span> i=1:size(sMatrix,3);
0121                 sMatrix(:,:,i) = (CSP.cspFilter*sMatrix(:,:,i)')';
0122             <span class="keyword">end</span>
0123             instances = zeros(numTrials,numChannels);
0124             <span class="keyword">for</span> i=1:numTrials
0125                 projectedTrial = sMatrix(:,:,i);
0126                 variances = var(projectedTrial,0,1);
0127                 instances(i,:) = log(variances)';
0128             <span class="keyword">end</span>
0129 <span class="comment">%             instanceSet = eegtoolkit.util.InstanceSet(instances,labels);</span>
0130         <span class="keyword">end</span>
0131     <span class="keyword">end</span>
0132 <span class="keyword">end</span>
0133</pre></div>
<hr><address>Generated on Fri 25-Nov-2016 17:12:22 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>